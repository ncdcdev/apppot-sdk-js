!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AppPotSDK=t():e.AppPotSDK=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){if(e){if(v)throw"AppPot is already configured";v=new _(e)}return v}var o=n(1),i=n(2),s=n(4),u=n(12),a=n(16),c=n(18),p=n(20),f=n(21),l=n(22),h=n(23),d=n(24),m=n(17),y=n(11),g=n(13),_=function(){function e(e){if(this._lock=[],!e)return this._inst;this._inst=this,this._config=new o.Config(e),this._authInfo=new i.AuthInfo(this),this._ajax=new s.Ajax(this._config,this._authInfo),this._isOnline=!0;var t={LocalAuthenticator:u.LocalAuthenticator};for(var n in t)this[n]=new t[n](this,this._config,this._authInfo);this.User=f.getUserClass(this),this.Model=c.Model,this.Device=p.default,this.Role=f.Role,this.File=h.getFileClass(this),this.GroupsRoles=f.GroupsRoles,this.DataType=m.DataType,this.Error=y.Error,this.Group=l.getGroupClass(this),this.Gateway=d.getGateway(this)}return e.prototype.uuid=function(){for(var e="",t=0;t<32;t++){var n=16*Math.random()|0;8!=t&&12!=t&&16!=t&&20!=t||(e+="-"),e+=(12==t?4:16==t?3&n|8:n).toString(16)}return e},e.prototype.isLocked=function(e){return this._lock[e]},e.prototype.lock=function(e){this._lock[e]=!0},e.prototype.unlock=function(e){this._lock[e]=!1},e.prototype.getAjax=function(){return this._ajax},e.prototype.getConfig=function(){return this._config},e.prototype.getAuthInfo=function(){return this._authInfo},e.prototype.getUser=function(){return this._authInfo.getUser()},e.prototype.defineModel=function(e,t){return c.Model.define(this,e,t)},e.prototype.createDatabase=function(e){return a.Database.createDatabase(this,e)},e.prototype.dropAndCreateDatabase=function(e){return a.Database.dropAndCreateDatabase(this,e)},e.prototype.setLocalDatabase=function(e){this._localDb=e},e.prototype.getLocalDatabase=function(){return this._localDb},e.prototype.getBuildDate=function(){return 1516077857},e.prototype.getVersion=function(){return["2","3","33"].join(".")||"unknown"},e.prototype.log=function(e,t){var n=this;return void 0===t&&(t="MONITOR"),this._authInfo.hasToken()?new g.Promise(function(r,o){n._ajax.post("logs").send({message:e,logLevel:t}).end(s.Ajax.end(r,o))}):g.Promise.reject("not logined")},e.prototype.sendPushNotification=function(e,t,n){var r=this;if(!this._authInfo.hasToken())return g.Promise.reject("not logined");var o=t instanceof Array?t:[t],i={message:e,target:o};return n&&(i.title=n),new g.Promise(function(e,t){r._ajax.post("messages").send(i).end(s.Ajax.end(e,t))})},e.prototype.isOnline=function(){return this._isOnline},e.prototype.online=function(e){this._isOnline=e},e.prototype.sendMail=function(e,t,n,r,o,i,u){var a=this;return this._authInfo.hasToken()?n instanceof Array&&r instanceof Array&&o instanceof Array?0==n.length&&0==r.length&&0==o.length?g.Promise.reject("destination address is not specified"):new g.Promise(function(c,p){a._ajax.post("emails").send({mailFrom:t,mailTo:n,mailCc:r,mailBcc:o,sendingRouteName:e,subject:i,body:u}).end(s.Ajax.end(c,p))}):g.Promise.reject("mailTo, mailCc, mailBcc must be array"):g.Promise.reject("not logined")},e}();t.AppPot=_;var v=null;t.getService=r},function(e,t){"use strict";var n=function(){function e(e){this.props=e;var t=this.props.url;"/"!=t.charAt(t.length-1)&&(this.props.url+="/"),this.props.deviceUDID="apppotsdkjs"}return Object.defineProperty(e.prototype,"entryPoint",{get:function(){return this.props.url+"api/"+this.props.companyId+"/"+this.props.appId+"/"+this.props.appVersion+"/"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this.props.timeout||1e4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this.props.url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appId",{get:function(){return this.props.appId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appKey",{get:function(){return this.props.appKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){return this.props.appVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceUDID",{get:function(){return this.props.deviceUDID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"companyId",{get:function(){return this.props.companyId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupId",{get:function(){return this.props.groupId},enumerable:!0,configurable:!0}),e}();t.Config=n},function(e,t,n){"use strict";var r=(n(3),function(){function e(e){this._token="",this.apppot=e}return e.prototype.hasToken=function(){return""!==this._token},e.prototype.getToken=function(){return this._token},e.prototype.getUser=function(){return this._user},e.prototype.setUser=function(e){this._user=e},e.prototype.setToken=function(e){this._token=e},e.prototype.clearUser=function(){this._user=null},e.prototype.clearToken=function(){this._token=""},e.prototype.serialize=function(){var e={};return e.token=this._token,e.user=this._user._columns,JSON.stringify(e)},e.prototype.deserialize=function(e){var t=JSON.parse(e);if(t){this.setToken(t.token);var n=new this.apppot.User(t.user);return this.setUser(n),!0}return!1},e}());t.AuthInfo=r},function(e,t){/*
	object-assign
	(c) Sindre Sorhus
	@license MIT
	*/
"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function r(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=r()?Object.assign:function(e,t){for(var r,u,a=n(e),c=1;c<arguments.length;c++){r=Object(arguments[c]);for(var p in r)i.call(r,p)&&(a[p]=r[p]);if(o){u=o(r);for(var f=0;f<u.length;f++)s.call(r,u[f])&&(a[u[f]]=r[u[f]])}}return a}},function(e,t,n){"use strict";var r=n(5),o=n(11),i=n(3),s=function(){function e(e,t){this._config=e,this._authInfo=t}return e.prototype.setToken=function(e){if(this._authInfo.hasToken()){var t=e.set("apppot-token",this._authInfo.getToken());return t}return e},e.prototype.buildOpts=function(e){return i({entryPoint:this._config.entryPoint,timeout:this._config.timeout,contentType:"application/json"},e)},e.prototype.get=function(e,t){var n=this.buildOpts(t),o=r.get(n.entryPoint+e).timeout(n.timeout);return this.setToken(o)},e.prototype.post=function(e,t){var n=this.buildOpts(t),o=r.post(n.entryPoint+e).timeout(n.timeout);return"no-set"!=n.contentType&&o.set("Content-Type",n.contentType),this.setToken(o)},e.prototype.update=function(e,t){return this.put(e,t)},e.prototype.put=function(e,t){var n=this.buildOpts(t),o=r.put(n.entryPoint+e).timeout(n.timeout);return"no-set"!=n.contentType&&o.set("Content-Type",n.contentType),this.setToken(o)},e.prototype.remove=function(e,t){var n=this.buildOpts(t),o=r.del(n.entryPoint+e).timeout(n.timeout);return"no-set"!=n.contentType&&o.set("Content-Type",n.contentType),this.setToken(o)},e.end=function(e,t,n,r){return function(i,s){if(i){var u={status:"error",results:i,response:s};r?r(u):t(u)}else{if(s.type.match("octet-stream"))return void e(s.text);var u=JSON.parse(s.text);u.hasOwnProperty("status")&&"error"==u.status?r?r(new o.Error(u.errCode,u.description)):t(new o.Error(u.errCode,u.description)):n?n(u):e(u)}}},e}();t.Ajax=s},function(e,t,n){function r(){}function o(e){var t={}.toString.call(e);switch(t){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function i(e){if(!v(e))return e;var t=[];for(var n in e)null!=e[n]&&s(t,n,e[n]);return t.join("&")}function s(e,t,n){return Array.isArray(n)?n.forEach(function(n){s(e,t,n)}):void e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}function u(e){for(var t,n,r={},o=e.split("&"),i=0,s=o.length;i<s;++i)n=o[i],t=n.split("="),r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return r}function a(e){var t,n,r,o,i=e.split(/\r?\n/),s={};i.pop();for(var u=0,a=i.length;u<a;++u)n=i[u],t=n.indexOf(":"),r=n.slice(0,t).toLowerCase(),o=j(n.slice(t+1)),s[r]=o;return s}function c(e){return/[\/+]json\b/.test(e)}function p(e){return e.split(/ *; */).shift()}function f(e){return g(e.split(/ *; */),function(e,t){var n=t.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(e[r]=o),e},{})}function l(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function h(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new l(n)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,e.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,e.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(e)}if(n.emit("response",t),e)return n.callback(e,t);if(t.status>=200&&t.status<300)return n.callback(e,t);var r=new Error(t.statusText||"Unsuccessful HTTP response");r.original=e,r.response=t,r.status=t.status,n.callback(r,t)})}function d(e,t){var n=b("DELETE",e);return t&&n.end(t),n}var m,y=n(6),g=n(7),_=n(8),v=n(9);m="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var b=e.exports=n(10).bind(null,h);b.getXHR=function(){if(!(!m.XMLHttpRequest||m.location&&"file:"==m.location.protocol&&m.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var j="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};b.serializeObject=i,b.parseString=u,b.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},b.serialize={"application/x-www-form-urlencoded":i,"application/json":JSON.stringify},b.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},l.prototype.get=function(e){return this.header[e.toLowerCase()]},l.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=p(t);var n=f(t);for(var r in n)this[r]=n[r]},l.prototype.parseBody=function(e){var t=b.parse[this.type];return!t&&c(this.type)&&(t=b.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null},l.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},l.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,r="cannot "+t+" "+n+" ("+this.status+")",o=new Error(r);return o.status=this.status,o.method=t,o.url=n,o},b.Response=l,y(h.prototype);for(var T in _)h.prototype[T]=_[T];h.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr&&this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},h.prototype.type=function(e){return this.set("Content-Type",b.types[e]||e),this},h.prototype.responseType=function(e){return this._responseType=e,this},h.prototype.accept=function(e){return this.set("Accept",b.types[e]||e),this},h.prototype.auth=function(e,t,n){switch(n||(n={type:"basic"}),n.type){case"basic":var r=btoa(e+":"+t);this.set("Authorization","Basic "+r);break;case"auto":this.username=e,this.password=t}return this},h.prototype.query=function(e){return"string"!=typeof e&&(e=i(e)),e&&this._query.push(e),this},h.prototype.attach=function(e,t,n){return this._getFormData().append(e,t,n||t.name),this},h.prototype._getFormData=function(){return this._formData||(this._formData=new m.FormData),this._formData},h.prototype.send=function(e){var t=v(e),n=this._header["content-type"];if(t&&v(this._data))for(var r in e)this._data[r]=e[r];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||o(e)?this:(n||this.type("json"),this)},l.prototype.parse=function(e){return m.console,this.serialize(e),this},l.prototype.serialize=function(e){return this._parser=e,this},h.prototype.callback=function(e,t){var n=this._callback;this.clearTimeout(),n(e,t)},h.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},h.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},h.prototype.withCredentials=function(){return this._withCredentials=!0,this},h.prototype.end=function(e){var t=this,n=this.xhr=b.getXHR(),i=this._query.join("&"),s=this._timeout,u=this._formData||this._data;this._callback=e||r,n.onreadystatechange=function(){if(4==n.readyState){var e;try{e=n.status}catch(t){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var a=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),e.direction="download",t.emit("progress",e)};this.hasListeners("progress")&&(n.onprogress=a);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=a)}catch(e){}if(s&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},s)),i&&(i=b.serializeObject(i),this.url+=~this.url.indexOf("?")?"&"+i:"?"+i),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof u&&!o(u)){var p=this._header["content-type"],f=this._parser||b.serialize[p?p.split(";")[0]:""];!f&&c(p)&&(f=b.serialize["application/json"]),f&&(u=f(u))}for(var l in this.header)null!=this.header[l]&&n.setRequestHeader(l,this.header[l]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send("undefined"!=typeof u?u:null),this},b.Request=h,b.get=function(e,t,n){var r=b("GET",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},b.head=function(e,t,n){var r=b("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},b.del=d,b.delete=d,b.patch=function(e,t,n){var r=b("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},b.post=function(e,t,n){var r=b("POST",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},b.put=function(e,t,n){var r=b("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}},function(e,t,n){function r(e){if(e)return o(e)}function o(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===t||r.fn===t){n.splice(o,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){e.exports=function(e,t,n){for(var r=0,o=e.length,i=3==arguments.length?n:e[r++];r<o;)i=t.call(null,i,e[r],++r,e);return i}},function(e,t,n){var r=n(9);t.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},t.parse=function(e){return this._parser=e,this},t.timeout=function(e){return this._timeout=e,this},t.then=function(e,t){return this.end(function(n,r){n?t(n):e(r)})},t.use=function(e){return e(this),this},t.get=function(e){return this._header[e.toLowerCase()]},t.getHeader=t.get,t.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},t.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},t.field=function(e,t){return this._getFormData().append(e,t),this}},function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},function(e,t){function n(e,t,n){return"function"==typeof n?new e("GET",t).end(n):2==arguments.length?new e("GET",t):new e(t,n)}e.exports=n},function(e,t){"use strict";var n=function(){function e(e,t){this._code=e,this._description=t}return Object.defineProperty(e.prototype,"code",{get:function(){return this._code},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),e}();t.Error=n},function(e,t,n){"use strict";var r=n(4),o=n(13),i=n(3),s=function(){function e(e){var t=this;this.login=function(e,n,r,o){return t.getAnonymousToken(o).then(function(){return!r||!o||t.devices(o)}).then(function(){return t.apiLogin(e,n,r,o)})},this.logout=function(){return t.apiLogout()},this.isLogined=function(){return t._isLogined},this.getAnonymousToken=function(e){return new o.Promise(function(n,o){t._appPot.getAjax().get("anonymousTokens").query("appKey="+t._appPot.getConfig().appKey).query("deviceUDID="+(e&&e.udid||t._appPot.getConfig().deviceUDID)).end(r.Ajax.end(n,o,function(e){t._appPot.getAuthInfo().setToken(e.results),n(e.results)}))})},this._appPot=e}return e.prototype.devices=function(e){var t=this;return new o.Promise(function(n,o){t._appPot.getAjax().post("devices").set("apppot-token",t._appPot.getAuthInfo().getToken()).send({deviceToken:e.token,deviceUDID:e.udid,deviceName:e.name,osType:e.osType}).end(r.Ajax.end(n,o,function(e){n()}))})},e.prototype.apiLogin=function(e,t,n,s){var u=this;return this._appPot.getAuthInfo().clearUser(),new o.Promise(function(o,a){u._appPot.getAjax().post("auth/login").set("apppot-token",u._appPot.getAuthInfo().getToken()).send({username:e,password:t,appId:u._appPot.getConfig().appId,deviceUDID:s?s.udid:u._appPot.getConfig().deviceUDID,isPush:!!n,appVersion:u._appPot.getConfig().appVersion,companyId:u._appPot.getConfig().companyId}).end(r.Ajax.end(function(e){e.authInfor&&(e.authInfo=e.authInfor,delete e.authInfor),u._appPot.getAuthInfo().setToken(e.authInfo.userTokens);var t=new u._appPot.User(i({},e.authInfo,e.authInfo.userInfo));u._appPot.getAuthInfo().setUser(t),u._isLogined=!0,o(u._appPot.getAuthInfo())},function(e){u._isLogined=!1,a(e)}))})},e.prototype.apiLogout=function(){var e=this;return new o.Promise(function(t,n){e._appPot.getAjax().post("auth/logout").set("apppot-token",e._appPot.getAuthInfo().getToken()).send({}).end(r.Ajax.end(function(n){e._appPot.getAuthInfo().clearToken(),e._appPot.getAuthInfo().clearUser(),e._isLogined=!1,t(e._appPot.getAuthInfo())},n))})},e}();t.LocalAuthenticator=s},function(e,t,n){(function(t,r){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   3.3.1
	 */
!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){W=e}function s(e){K=e}function u(){return function(){return t.nextTick(l)}}function a(){return function(){V(l)}}function c(){var e=0,t=new Z(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function p(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<J;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}J=0}function h(){try{var e=n(15);return V=e.runOnLoop||e.runOnContext,a()}catch(e){return f()}}function d(e,t){var n=arguments,r=this,o=new this.constructor(y);void 0===o[oe]&&q(o);var i=r._state;return i?!function(){var e=n[i-1];K(function(){return L(i,o,e,r._result)})}():P(r,o,e,t),o}function m(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(y);return O(n,e),n}function y(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function v(e){try{return e.then}catch(e){return ae.error=e,ae}}function b(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function j(e,t,n){K(function(e){var r=!1,o=b(n,t,function(n){r||(r=!0,t!==n?O(e,n):I(e,n))},function(t){r||(r=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,x(e,o))},e)}function T(e,t){t._state===se?I(e,t._result):t._state===ue?x(e,t._result):P(t,void 0,function(t){return O(e,t)},function(t){return x(e,t)})}function w(e,t,n){t.constructor===e.constructor&&n===d&&t.constructor.resolve===m?T(e,t):n===ae?x(e,ae.error):void 0===n?I(e,t):o(n)?j(e,t,n):I(e,t)}function O(t,n){t===n?x(t,g()):e(n)?w(t,n,v(n)):I(t,n)}function A(e){e._onerror&&e._onerror(e._result),E(e)}function I(e,t){e._state===ie&&(e._result=t,e._state=se,0!==e._subscribers.length&&K(E,e))}function x(e,t){e._state===ie&&(e._state=ue,e._result=t,K(A,e))}function P(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+se]=n,o[i+ue]=r,0===i&&e._state&&K(E,e)}function E(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?L(n,r,o,i):o(i);e._subscribers.length=0}}function k(){this.error=null}function N(e,t){try{return e(t)}catch(e){return ce.error=e,ce}}function L(e,t,n,r){var i=o(n),s=void 0,u=void 0,a=void 0,c=void 0;if(i){if(s=N(n,r),s===ce?(c=!0,u=s.error,s=null):a=!0,t===s)return void x(t,_())}else s=r,a=!0;t._state!==ie||(i&&a?O(t,s):c?x(t,u):e===se?I(t,s):e===ue&&x(t,s))}function D(e,t){try{t(function(t){O(e,t)},function(t){x(e,t)})}catch(t){x(e,t)}}function C(){return pe++}function q(e){e[oe]=pe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function S(e,t){this._instanceConstructor=e,this.promise=new e(y),this.promise[oe]||q(this.promise),z(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&I(this.promise,this._result))):x(this.promise,R())}function R(){return new Error("Array Methods must be provided an Array")}function U(e){return new S(this,e).promise}function M(e){var t=this;return new t(z(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function F(e){var t=this,n=new t(y);return x(n,e),n}function B(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function H(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[oe]=C(),this._result=this._state=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&B(),this instanceof G?D(this,e):H())}function X(){var e=void 0;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=G}var Q=void 0;Q=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z=Q,J=0,V=void 0,W=void 0,K=function(e,t){ne[J]=e,ne[J+1]=t,J+=2,2===J&&(W?W(l):re())},$="undefined"!=typeof window?window:void 0,Y=$||{},Z=Y.MutationObserver||Y.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=void 0;re=ee?u():Z?c():te?p():void 0===$?h():f();var oe=Math.random().toString(36).substring(16),ie=void 0,se=1,ue=2,ae=new k,ce=new k,pe=0;return S.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ie&&n<e;n++)this._eachEntry(t[n],n)},S.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===m){var o=v(e);if(o===d&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===G){var i=new n(y);w(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},S.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ie&&(this._remaining--,e===ue?x(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},S.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ue,t,e)})},G.all=U,G.race=M,G.resolve=m,G.reject=F,G._setScheduler=i,G._setAsap=s,G._asap=K,G.prototype={constructor:G,then:d,catch:function(e){return this.then(null,e)}},X(),G.polyfill=X,G.Promise=G,G})}).call(t,n(14),function(){return this}())},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(p===setTimeout)return setTimeout(e,0);if((p===n||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){m&&h&&(m=!1,h.length?d=h.concat(d):y=-1,d.length&&u())}function u(){if(!m){var e=o(s);m=!0;for(var t=d.length;t;){for(h=d,d=[];++y<t;)h&&h[y].run();y=-1,t=d.length}h=null,m=!1,i(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var p,f,l=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:n}catch(e){p=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var h,d=[],m=!1,y=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new a(e,t)),1!==d.length||m||o(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t){},function(e,t,n){"use strict";var r=n(17),o=n(4),i=n(13),s=n(11),u=function(){function e(){}return e.dropAndCreateDatabase=function(t,n){return e._createAppData(t,n,!0)},e.createDatabase=function(t,n){return e._createAppData(t,n,!1)},e.createLocalTable=function(t,n){var r=e.getTableDefinition(n),o=(r.table,r.errors);0!=o.length},e._makeDefaultTable=function(e){return{primary_key:"objectId",name:e,columns:[{colName:"objectId",type:"varchar"},{colName:"scopeType",type:"varchar"},{colName:"createTime",type:"long"},{colName:"updateTime",type:"long"}]}},e.mapType2SqliteType=function(e){switch(e){case"varchar":return"TEXT";case"integer":case"long":return"NUMERIC"}},e._buildColumnItem=function(e,t){var n={colName:e,type:r.DataType[t.type].toLowerCase()};switch(n.type){case"varchar":n.fieldLength=t.length;break;case"bool":n.type="varchar",n.fieldLength=1;break;case"datetime":n.type="long";break;case"double":n.type="varchar",n.fieldLength=255}return n},e.getSqliteTableDefinition=function(t){var n=e.getTableDefinition(t),r=n.table,o=n.errors;if(0!=o.length)throw new s.Error(-1,o.join("\n"));var i=r.name,u=r.primary_key,a=r.columns.map(function(t){return t.colName==u?"`"+t.colName+"` "+e.mapType2SqliteType(t.type)+" PRIMARY KEY":"`"+t.colName+"` "+e.mapType2SqliteType(t.type)});return a.push("serverCreateTime TEXT"),a.push("serverUpdateTime TEXT"),["CREATE TABLE IF NOT EXISTS "+i+" ( "+a.join(",")+" );","CREATE TABLE IF NOT EXISTS apppot_"+i+"_queue ( `type` TEXT, `id` TEXT PRIMARY KEY, `serverUpdateTime` TEXT);"]},e.getTableDefinition=function(t){var n=[],r=t.modelColumns,o=t.className;if(!o)throw new s.Error(-1,"table name is Required");var i=e._makeDefaultTable(o);for(var u in r)"objectId"!=u?"function"!=typeof r[u]&&"scopeType"!=u&&i.columns.push(e._buildColumnItem(u,r[u])):n.push("invalid column name: "+o+"."+u);return{table:i,errors:n}},e._createAppData=function(t,n,r){var u=[],a=[];for(var c in n)try{var p=e.getTableDefinition(n[c]),f=p.table,l=p.errors;a=a.concat(l),u.push(f)}catch(e){return i.Promise.reject(e)}if(0!=a.length)return i.Promise.reject(new s.Error(-1,a.join("\n")));var h={appId:t.getConfig().appId,appVersion:t.getConfig().appVersion,isResetDatabase:r,companyId:t.getConfig().companyId,tables:u};return new i.Promise(function(e,n){t.getAjax().post("schemas").send(h).end(o.Ajax.end(e,n))})},e}();t.Database=u},function(e,t){"use strict";!function(e){e[e.Varchar=0]="Varchar",e[e.Integer=1]="Integer",e[e.Long=2]="Long",e[e.Bool=3]="Bool",e[e.DateTime=4]="DateTime",e[e.Double=5]="Double"}(t.DataType||(t.DataType={}));t.DataType},function(e,t,n){"use strict";var r,o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(17),s=n(4),u=n(11),a=n(13),c=n(16),p=n(19),f=n(3);!function(e){function t(e,t,n){var r=n?n:m[e];return t?new r(t):new r}function n(e,t,n){Object.keys(n).forEach(function(e){if(y.indexOf(e)!=-1)throw new u.Error(-1,"Invalid column name: "+e)});var r=+l.Group;return m[t]=function(){function o(e){var t=this;this._columns={},Object.keys(n).forEach(function(e){"function"==typeof n[e]?Object.defineProperty(t,e,{enumerable:!0,configurable:!0,value:n[e].bind(t)}):"scopeType"==e?r=+n[e].type:Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){this.set(e,t)},enumerable:!0,configurable:!0})}),g.forEach(function(e){if(!t.hasOwnProperty(e))switch(e){case"scopeType":Object.defineProperty(t,e,{get:function(){return+this.get(e)},set:function(t){this.set(e,+t)},enumerable:!0,configurable:!0});break;default:Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){this.set(e,t)},enumerable:!0,configurable:!0})}}),e&&this.set(e)}return o._getColumnsPlaceholders=function(e){var n=Object.keys(m[t].filterDefinedColumnOnly({})).map(function(e){return e}),r=n.map(function(e){return"?"});return{colNames:n,placeholders:r}},o._insertAllLocal=function(n){var r=m[t]._normalizeColumns(n),o=r.columns,i=r.models,s=m[t]._getColumnsPlaceholders(),u=s.colNames,f=s.placeholders,l=[],h=o.map(function(n,r){return u.map(function(o){if("objectId"==o&&(null===n[o]||void 0===n[o])){var s=t+"_"+e.uuid();return i[r].set("objectId",s),l[r]=s,s}return n[o]})});return new a.Promise(function(n,r){var o=e.getLocalDatabase();o||r("Local Database is undefined");var s=c.Database.getSqliteTableDefinition(m[t]);o.transaction(function(e){s.forEach(function(t){e.executeSql(t)}),h.forEach(function(n,r){var o=u.map(function(e){return"`"+e+"`"}),i="INSERT INTO "+t+" ( "+o.join(",")+" ) VALUES ( "+f.join(",")+" )";e.executeSql(i,n,function(){var n="INSERT INTO "+p.default.getQueueTableName(t)+" ( `type`, `id`, `serverUpdateTime` ) VALUES ( ?, ?, ? )",o=["created",l[r],null];e.executeSql(n,o)})})},function(e){r(e)},function(){n(i)})})},o._insertAll=function(e){var n=m[t]._normalizeColumns(e),r=n.columns,o=n.models;return m[t]._rawInsert(r).then(function(e){return e.results.forEach(function(e,t){o[t].set(e)}),o})},o.insertAll=function(n){return e.isOnline()?m[t]._insertAll(n):m[t]._insertAllLocal(n)},o._insertLocal=function(e){return m[t]._insertAllLocal([e]).then(function(e){return e[0]})},o._insert=function(e){var n=this;if(e instanceof Array)throw"invalid argument type: use insertAll";var r=[m[t].formatColumns(e,!0)];return m[t]._rawInsert(r).then(function(e){var o=f({},r[0],e.results[0]);return new(n||m[t])(o)})},o.insert=function(n){return e.isOnline()?m[t]._insert(n):m[t]._insertLocal(n)},o._findByIdLocal=function(e){return m[t]._selectLocal().where("objectId = ?",e).findOne().then(function(e){return e[t]?e[t]:a.Promise.reject("not found")})},o._findById=function(n){var r=this,o=function(o,i){e.getAjax().get("data/"+t+"/"+n).end(s.Ajax.end(function(e){var n=new(r||m[t])(e[t][0]);o(n)},i))};return new a.Promise(o)},o.findById=function(n){return e.isOnline()?m[t]._findById(n):m[t]._findByIdLocal(n)},o._findAllLocal=function(){return m[t]._selectLocal().findList()},o._findAll=function(){return m[t].select().findList()},o.findAll=function(){return e.isOnline()?m[t]._findAll():m[t]._findAllLocal()},o._selectLocal=function(n){return n&&(n=n.replace(/^#+/,"")),new _(e,this||m[t],n,e.getLocalDatabase())},o._select=function(n){return n&&(n=n.replace(/^#+/,"")),new _(e,this||m[t],n)},o.select=function(n){return e.isOnline()?m[t]._select(n):m[t]._selectLocal(n)},o.count=function(e){return m[t].select().count(e)},o.prototype._insertLocal=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];return this.set.apply(this,n),this.isNew()?m[t]._insertLocal(this.get()).then(function(){return e}):a.Promise.reject(new u.Error(-1,"object is created"))},o.prototype._insert=function(){for(var n=this,r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];if(this.set.apply(this,r),!this.isNew())return a.Promise.reject(new u.Error(-1,"object is created"));var i=function(r,o){var i=m[t].formatColumns(n._columns,!0);e.getAjax().post("data/batch/addData").send({objectName:t,data:[i]}).end(s.Ajax.end(function(e){r(n.set(e.results[0]))},o))};return new a.Promise(i)},o.prototype.insert=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];return e.isOnline()?this._insert.apply(this,t):this._insertLocal.apply(this,t)},o.prototype._updateLocal=function(){for(var n=this,r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];if(this.isNew())return a.Promise.reject(new u.Error(-1,"object is not created"));this.set.apply(this,r);var i=m[t].formatColumns(this._columns,!1),s=(new p.default).translateUpdate(t,i.objectId,i);return new a.Promise(function(r,o){var u=e.getLocalDatabase();u.transaction(function(e){e.executeSql(s.query,s.params,function(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];var o="INSERT OR IGNORE INTO "+p.default.getQueueTableName(t)+" ( `type`, `id`, `serverUpdateTime` ) VALUES ( ?, ?, ? )",s=["updated",i.objectId,null];e.executeSql(o,s)})},function(e){o(e)},function(){r(n)})})},o.prototype._update=function(){for(var n=this,r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];if(this.isNew())return a.Promise.reject(new u.Error(-1,"object is not created"));this.set.apply(this,r);var i=function(r,o){var i=m[t].formatColumns(n._columns,!1);e.getAjax().post("data/batch/updateData").send({objectName:t,data:[i]}).end(s.Ajax.end(function(e){n.set(e.results[0]),r(n)},o))};return new a.Promise(i)},o.prototype.update=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];return e.isOnline()?this._update.apply(this,t):this._updateLocal.apply(this,t)},o.prototype._saveLocal=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.isNew()?this._insertLocal.apply(this,e):this._updateLocal.apply(this,e)},o.prototype._save=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.isNew()?this._insert.apply(this,e):this._update.apply(this,e)},o.prototype.save=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];return e.isOnline()?this._save.apply(this,t):this._saveLocal.apply(this,t)},o.removeById=function(e){return m[t].findById(e).then(function(e){return e.remove()})},o.prototype._removeLocal=function(){var n=this;return new a.Promise(function(r,o){var i=e.getLocalDatabase();i.transaction(function(e){var r=(new p.default).translateDelete(t,n.get("objectId"));e.executeSql(r.query,r.params);var o="SELECT type FROM "+p.default.getQueueTableName(t)+" WHERE id = ?",i=[n.get("objectId")];e.executeSql(o,i,function(){for(var r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];var i="INSERT OR REPLACE INTO "+p.default.getQueueTableName(t)+" ( `type`, `id`, `serverUpdateTime` ) VALUES ( ?, ?, ? )",s=["deleted",n.get("objectId"),n.get("serverUpdateTime")];r[1].rows.length>0&&"created"==r[1].rows.item(0).type&&(i="DELETE FROM "+p.default.getQueueTableName(t)+" WHERE id = ?",s=[n.get("objectId")]),e.executeSql(i,s)})},function(e){o(e)},function(){r(!0)})})},o.prototype._remove=function(){var n=this,r=function(r,o){e.getAjax().post("data/batch/deleteData").send({objectName:t,objectIds:[{objectId:n.get("objectId"),serverUpdateTime:n.get("serverUpdateTime")}]}).end(s.Ajax.end(r,o))};return new a.Promise(r)},o.prototype.remove=function(){return e.isOnline()?this._remove.apply(this):this._removeLocal.apply(this)},o.prototype.isNew=function(){return!this._columns.objectId},o.countUnsent=function(){return new a.Promise(function(n,r){var o=null,i=e.getLocalDatabase();i.transaction(function(e){e.executeSql("SELECT * FROM "+p.default.getQueueTableName(t),[],function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];o={created:0,updated:0,deleted:0};for(var n=0;n<e[1].rows.length;n++){var r=e[1].rows.item(n);o[r.type]++}})},function(e){r(e)},function(){n(o)})})},o.getUnsents=function(){return new a.Promise(function(n,r){var o={created:[],updated:[],deleted:[]},i=e.getLocalDatabase();i.transaction(function(e){e.executeSql("SELECT * FROM "+p.default.getQueueTableName(t),[],function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var n=0;n<e[1].rows.length;n++){var r=e[1].rows.item(n);o[r.type].push({objectId:r.id,serverUpdateTime:r.serverUpdateTime})}})},function(e){r()},function(){n(o)})}).then(function(e){return a.Promise.all([m[t]._selectLocal().valuesIn("objectId",e.created.map(function(e){return e.objectId})).findList(),m[t]._selectLocal().valuesIn("objectId",e.updated.map(function(e){return e.objectId})).findList(),a.Promise.resolve(e.deleted)])}).then(function(e){return{created:e[0][t],updated:e[1][t],deleted:e[2]}})},o.downlink=function(n){if(!e.isOnline())throw"offline mode";if(e.isLocked(t))throw"now locking";return new v(e,this||m[t],n).setLocalDatabase(e.getLocalDatabase())},o.clearQueue=function(n){return new a.Promise(function(r,o){var i=e.getLocalDatabase();i.transaction(function(e){var r="DELETE FROM "+p.default.getQueueTableName(t)+" WHERE type = ?";e.executeSql(r,[n])},function(e){o(e)},function(){r()})})},o.uplink=function(n){if(!e.isOnline())throw"offline mode";if(e.isLocked(t))throw"now locking";n||(n=function(){});var r=null,o={update:[],delete:[]};return e.lock(t),m[t].getUnsents().then(function(e){return r=e,m[t]._insertAll(r.created)}).then(function(){return m[t].clearQueue("created")}).then(function(){return a.Promise.all(r.updated.map(function(e){return e.update().catch(function(t){return o.update.push(e),a.Promise.resolve()})}))}).then(function(){return m[t].clearQueue("updated")}).then(function(){return a.Promise.all(r.deleted.map(function(n){return new a.Promise(function(r,o){e.getAjax().post("data/batch/deleteData").send({objectName:t,objectIds:[{objectId:n.objectId,serverUpdateTime:n.serverUpdateTime}]}).end(s.Ajax.end(r,o))}).catch(function(e){return o.delete.push(n),a.Promise.resolve()})}))}).then(function(){return m[t].clearQueue("deleted")}).then(function(){e.unlock(t),(o.update&&0!=o.update.length||o.deleted&&0!=o.deleted.length)&&n(o)}).catch(function(n){return e.unlock(t),a.Promise.reject(n)})},o._debug=function(){var n=[];return new a.Promise(function(r,o){var i=e.getLocalDatabase();i.transaction(function(e){e.executeSql("SELECT * FROM "+t,[],function(){for(var r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];for(var i=0;i<r[1].rows.length;i++)n.push(r[1].rows.item(i));e.executeSql("SELECT * FROM "+p.default.getQueueTableName(t),[],function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var r=0;r<e[1].rows.length;r++)n.push(e[1].rows.item(r))})})},function(e){o(e)},function(){r(n)})})},o.prototype.get=function(e){return e?this._columns[e]:this._columns},o.prototype.set=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];var o={};return 1==n.length&&"object"==typeof n[0]?o=n[0]:o[n[0]]=n[1],this._columns=f({},this._columns,o),this._columns=m[t].sliceColumns(this._columns),this._columns=m[t].parseColumns(this._columns),Object.keys(this._columns).forEach(function(e){if(y.indexOf(e)!=-1)throw new u.Error(-1,"Invalid column name: "+e)}),Object.keys(this._columns).forEach(function(t){e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){this.set(t,e)},enumerable:!0,configurable:!0})}),this},o.sliceColumns=function(e){return m[t].noNeedColumns.forEach(function(t){delete e[t]}),e},o.parseColumns=function(e){var t={};return f(t,e),Object.keys(n).forEach(function(r){"scopeType"!=r&&null!==e[r]&&void 0!==e[r]&&(n[r].type==i.DataType.Long||n[r].type==i.DataType.Integer?""===e[r]?t[r]=null:t[r]=parseInt(e[r]):n[r].type==i.DataType.Bool&&"boolean"!=typeof t[r]?""===e[r]?t[r]=null:t[r]=!!parseInt(e[r]):n[r].type!=i.DataType.DateTime||t[r]instanceof Date?n[r].type==i.DataType.Double&&(""===e[r]?t[r]=null:t[r]=parseFloat(e[r])):""===e[r]?t[r]=null:t[r]=new Date(parseInt(e[r])))}),t},o.formatColumns=function(e,r){var o={};return f(o,e),Object.keys(n).forEach(function(r){if("scopeType"!=r&&null!==e[r]&&void 0!==e[r])if(n[r].type==i.DataType.Bool)o[r]=e[r]?1:0;else if(n[r].type==i.DataType.DateTime){if(!(e[r]instanceof Date))throw new u.Error(-1,"invalid type: column "+t+'"."'+r+'"');o[r]=e[r].getTime()}else n[r].type==i.DataType.Double&&("number"==typeof e[r]?o[r]=e[r]+"":o[r]=parseFloat(e[r])+"")}),r&&(o.createTime=Date.now()/1e3),o.updateTime=Date.now()/1e3,m[t].filterDefinedColumnOnly(o)},o.filterDefinedColumnOnly=function(e){var t={};return Object.keys(n).forEach(function(n){t[n]=e[n]}),t.objectId=e.objectId,t.scopeType=+(e.scopeType||r),t.serverCreateTime=e.serverCreateTime,t.serverUpdateTime=e.serverUpdateTime,t.createTime=e.createTime,t.updateTime=e.updateTime,t},o._rawInsert=function(n){return new a.Promise(function(r,o){e.getAjax().post("data/batch/addData").send({objectName:t,data:n}).end(s.Ajax.end(r,o))})},o._normalizeColumns=function(e){var n,r,i=this;return e[0]instanceof o?(r=e,n=r.map(function(e){return e.get()})):(n=e,r=n.map(function(e){var n=new(i||m[t])(e);return n})),{columns:r.map(function(e){return m[t].formatColumns(e.get(),!0)}),models:r}},o.className=t,o.modelColumns=n,o.noNeedColumns=["groupIds"],o}(),m[t]}var r=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n;e[0]instanceof Array?(this._query=e[0][0],n=e[0].slice(1)):"string"==typeof e[0].source?(this._query=e[0].source,n=e[0].params||[]):(this._query=e[0],n=e.slice(1)),n instanceof Array?this._params=n:this._params=[n]}return e.prototype.getQuery=function(){var e={source:this._query};return this._params&&(e.params=this._params),e},e.prototype.concatBy=function(e,t){var n=t.getQuery(),r={source:"( "+this._query+" ) "+e+" ( "+n.source+" )"},o=[].concat(this._params||[],n.params||[]);return o.length>0&&(r.params=o),r},e}();e.Expression=r,function(e){e[e.User=1]="User",e[e.Group=2]="Group",e[e.All=3]="All"}(e.ScopeType||(e.ScopeType={}));var l=e.ScopeType;!function(e){e[e.LeftInner=1]="LeftInner",e[e.LeftOuter=2]="LeftOuter",e[e.RightOuter=3]="RightOuter",e[e.Inner=4]="Inner"}(e.JoinType||(e.JoinType={}));var h=e.JoinType;!function(e){e[e.asc=0]="asc",e[e.desc=1]="desc"}(e.Order||(e.Order={}));var d=e.Order,m={},y=["isNew","get","set","insert","update","save","remove"],g=["objectId","scopeType","serverCreateTime","serverUpdateTime","createTime","updateTime"];e.define=n;var _=function(){function e(e,t,n,r){this._class=t,this._queryObj={from:{phyName:this._class.className}},this._appPot=e,this._localDB=r||!1,this._useLocal=!!r,this._ajax=e.getAjax(),n?this._queryObj.from.alias=n:this._queryObj.from.alias=this._class.className,this._keyClassMap={},this._keyClassMap[this._queryObj.from.alias]=this._class.className}return e.prototype.normalizeExpression=function(e){if(e.length>=2)return new r(e);if(e[0]instanceof r)return e[0];if("string"==typeof e[0])return new r(e[0]);throw"faild to normalize expression: "+JSON.stringify(e)},e.prototype.valuesIn=function(e,t){for(var n=this._queryObj.from.alias,r="#"+n+"."+e+" = ?",o=0;o<t.length-1;o++)r+=" or #"+n+"."+e+" = ?";var i=this.normalizeExpression([r].concat(t));return this.setWhereExpression(i),this},e.prototype.where=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=this.normalizeExpression(e);return this.setWhereExpression(n),this},e.prototype.setWhereExpression=function(e){if(this._queryObj.where){if(!this._concat)throw"Multiple WHERE condition in not set and/or";var t=new r(this._queryObj.where.expression);this._queryObj.where.expression=t.concatBy(this._concat,e),this._concat=null}else this._queryObj.where={},this._queryObj.where.expression=e.getQuery()},e.prototype.and=function(){return this._concat="AND",this},e.prototype.or=function(){return this._concat="OR",this},e.prototype.join=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=h.LeftInner,o=e.className;if("number"==typeof t[0]&&(r=t.shift()),"object"==typeof t[0]){var i=t.shift();o=i.alias?i.alias:o,r=i.joinType?i.joinType:r}var s="LEFT JOIN";switch(r){case h.LeftOuter:s="LEFT OUTER JOIN";break;case h.LeftInner:s="LEFT JOIN";break;case h.RightOuter:s="RIGHT OUTER JOIN";break;case h.Inner:s="INNER JOIN"}var u=this.normalizeExpression(t);return this._queryObj.join||(this._queryObj.join=[]),this._queryObj.join.push({type:s,entity:e.className,entityAlias:o,expression:u.getQuery()}),this._keyClassMap[o]=e.className,this},e.prototype.orderBy=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._queryObj.orderBy||(this._queryObj.orderBy=[]);var n={};return"string"==typeof e[0]&&(n.column=e[0],1==e.length?n.type="asc":"string"==typeof e[1]?n.type=e[1]:n.type=d[e[1]]),this._queryObj.orderBy.push(n),this},e.prototype.limit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this._queryObj.range={limit:e[0]||1e3,offset:1},2==e.length&&(this._queryObj.range.offset=e[1]+1),this},e.prototype.resetQuery=function(){return this._queryObj={},this},e.prototype.findOne=function(){var e=this;return this._queryObj.range=this._queryObj.range||{limit:1,offset:1},this._useLocal?this._queryToLocal().then(function(e){var t={};return Object.keys(e).forEach(function(n){t[n]=e[n][0]}),t}):this._post().then(function(n){var r={};return Object.keys(e._keyClassMap).forEach(function(o){var i=e._keyClassMap[o],s=!1;i==e._class.className&&(s=e._class),n[o]?r[o]=t(i,n[o][0],s):r[o]=t(i,n[i][0],s)}),r})},e.prototype.findList=function(){var e=this;return this._useLocal?this._queryToLocal():this._post().then(function(n){var r={};return Object.keys(e._keyClassMap).forEach(function(o){r[o]=[];var i=e._keyClassMap[o],s=!1;i==e._class.className&&(s=e._class);var u=n[o]?n[o]:n[i];u.forEach(function(e,n){r[o].push(t(i,e,s))})}),r})},e.prototype.count=function(){return this._post(!0).then(function(e){return e})},e.prototype._queryToLocal=function(){var e=this;return new a.Promise(function(t,n){var r=(new p.default).translateSelect(e._queryObj,e._keyClassMap,m);e._localDB||n("Local Database is undefined");var o=[];e._localDB.transaction(function(e){e.executeSql(r.query,r.params,function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var n=0;n<e[1].rows.length;n++)o.push(e[1].rows.item(n))})},function(e){n(e)},function(){t(o)})}).then(function(n){var r={};Object.keys(e._keyClassMap).forEach(function(e){r[e]=[]}),n.forEach(function(e,t){Object.keys(e).forEach(function(n){var o=n.match(/(.*)____(.*)/),i=o[1],s=o[2];r[i][t]||(r[i][t]={}),r[i][t][s]=e[n]})});var o={};return Object.keys(r).forEach(function(n){o[n]=r[n].map(function(r){return t(e._keyClassMap[n],r)})}),o})},e.prototype._post=function(e){var t=this;void 0===e&&(e=!1);var n="";e&&(n="/count");var r=function(e,r){t._ajax.post("data/query/"+t._class.className+n).send(t._queryObj).end(s.Ajax.end(e,function(n){if(n.response&&404==n.response.statusCode){var o=[t._class.className];t._queryObj.join instanceof Array&&t._queryObj.join.forEach(function(e){o.push(e.entity)});var i={};o.forEach(function(e){i[e]=[]}),e(i)}else r(n)}))};return new a.Promise(r)},e}(),v=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.findOne=function(){return a.Promise.reject('Cannot use "findOne" method to downlink. Please use "execute" method.')},t.prototype.findList=function(){return a.Promise.reject('Cannot use "findList" method to downlink. Please use "execute" method.')},t.prototype.setLocalDatabase=function(e){return this._localDB=e,this},t.prototype.execute=function(){var t=this,n=function(e){return function(n,r){t._localDB.transaction(function(n){var r=t._class.className,o=m[r]._getColumnsPlaceholders(),i=o.colNames,s=o.placeholders,u=i.map(function(e){return"`"+e+"`"}),a=c.Database.getSqliteTableDefinition(t._class);a.forEach(function(e){n.executeSql(e)}),n.executeSql("DELETE FROM "+r),n.executeSql("DELETE FROM "+p.default.getQueueTableName(r));var f="INSERT INTO "+r+" ("+u.join(",")+") VALUES ("+s.join(",")+");";e[r].forEach(function(e){var t=i.map(function(t){return e.get(t)});n.executeSql(f,t)})},function(e){t._appPot.unlock(t._class.className),r(e)},function(){t._appPot.unlock(t._class.className),n()})}};return this._appPot.lock(this._class.className),e.prototype.findList.call(this).then(function(e){return new a.Promise(n(e))})},t}(_)}(r=t.Model||(t.Model={}))},function(e,t){"use strict";var n=function(){function e(){this._params=[]}return e.getQueueTableName=function(e){return"apppot_"+e+"_queue"},e.prototype.translateDelete=function(e,t){return{query:"DELETE FROM "+e+" WHERE objectId = ?",params:[t]}},e.prototype.translateUpdate=function(e,t,n){var r=[],o=Object.keys(n).map(function(e){return r.push(n[e]),"`"+e+"` = ?"});return r.push(t),{query:"UPDATE "+e+" SET "+o.join(",")+" WHERE objectId = ?",params:r}},e.prototype.translateSelect=function(e,t,n){this._keyClassMap=t,this._classList=n;var r=this.selectFromJoin(e)+" "+this.where(e)+" "+this.order(e)+" "+this.limit(e);return{query:r,params:this._params}},e.prototype.getClass=function(e){return this._classList[this._keyClassMap[e]]},e.prototype.expression=function(e,t){return this._params=this._params.concat(t),e.replace(/#/g,"")},e.prototype.limit=function(e){if(!e.range)return"";var t=e.range;
return"LIMIT "+t.limit+" OFFSET "+(t.offset-1)},e.prototype.order=function(e){if(!e.orderBy||0==e.orderBy.length)return"";var t=e.orderBy;return"order by "+t.map(function(e){return e.column+" "+e.type}).join(",")},e.prototype.where=function(e){if(e.where&&e.where.expression){var t=e.where.expression;return"WHERE "+this.expression(t.source,t.params)}return""},e.prototype.selectFromJoin=function(e){var t=this,n=e.from.alias,r=this.getClass(n),o=Object.keys(r.modelColumns).map(function(e){return"`"+n+"`.`"+e+"` AS "+n+"____"+e});o.push("`"+n+"`.`objectId` AS "+n+"____objectId"),o.push("`"+n+"`.`serverCreateTime` AS "+n+"____serverCreateTime"),o.push("`"+n+"`.`serverUpdateTime` AS "+n+"____serverUpdateTime");var i="FROM "+e.from.phyName;return e.from.phyName!=e.from.alias&&(i+=" AS "+e.from.alias),e.join&&e.join.length>0&&e.join.forEach(function(e){var n=e.entityAlias;i+=" "+e.type+" "+e.entity,e.entity!=n&&(i+=" AS "+n);var r=t.expression(e.expression.source,e.expression.params);i+=" ON "+r+" ";var s=Object.keys(t.getClass(n).modelColumns).map(function(e){return"`"+n+"`.`"+e+"` AS "+n+"____"+e});s.push("`"+n+"`.`objectId` AS "+n+"____objectId"),o=o.concat(s)}),"SELECT "+o.join(",")+" "+i},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";var n=function(){function e(e){var t=this;this._columns={udid:"",name:"",osType:"",token:""},Object.keys(this._columns).forEach(function(n){e[n]&&(t._columns[n]=e[n])})}return Object.defineProperty(e.prototype,"udid",{get:function(){return this._columns.udid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this._columns.token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._columns.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"osType",{get:function(){return this._columns.osType},enumerable:!0,configurable:!0}),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e){return function(){function t(e){this._columns={account:"",firstName:"",lastName:"",password:"",userId:null},this.set(e)}return t.prototype.set=function(e){var t=this;Object.keys(this._columns).forEach(function(n){e[n]&&(t._columns[n]=e[n])});var n=e.groupsRoles||e.groupsAndRoles||e.groupRoleMap||this.groupsRoles;if(n instanceof u)n=[n];else if(!(n instanceof Array))throw"Invalid arguments groupsRoles";return this._columns.groupsRoles=n.map(function(e){return new u(e)}),this},Object.defineProperty(t.prototype,"account",{get:function(){return this._columns.account},set:function(e){this._columns.account=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstName",{get:function(){return this._columns.firstName},set:function(e){this._columns.firstName=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastName",{get:function(){return this._columns.lastName},set:function(e){this._columns.lastName=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userId",{get:function(){return this._columns.userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this._columns.password},set:function(e){this._columns.password=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupsRoles",{get:function(){return this._columns.groupsRoles},set:function(e){if(!(e instanceof u))throw"arguments is invalid type of class";this._columns.groupsRoles=e},enumerable:!0,configurable:!0}),t._isNumber=function(e){return("number"==typeof e||"string"==typeof e)&&(e==parseFloat(e)&&isFinite(e))},t.findById=function(n,r){return this._isNumber(n)?new i.Promise(function(i,s){e.getAjax().get("users/"+n,r).query({token:e.getAuthInfo().getToken()}).end(o.Ajax.end(function(e){i(new t(e.user))},s))}):i.Promise.reject("userId is not a number")},t.list=function(n,r){var s={};return this._isNumber(n)?s.groupId=n:s=n,new i.Promise(function(n,i){e.getAjax().get("users",r).query({token:e.getAuthInfo().getToken()}).query(s).end(o.Ajax.end(function(e){var r=e.users,o=r.map(function(e){return new t(e)});n(o)},i))})},t.prototype._getObjForUserAPI=function(){return{account:this.account,firstName:this.firstName,lastName:this.lastName,password:this.password,groupRoleMap:this.groupsRoles.map(function(e){return e.getGroupsRolesForUserAPI()})}},t.prototype.create=function(t){var n=this;return new i.Promise(function(r,i){var s=n._getObjForUserAPI();e.getAjax().post("users",t).send(s).end(o.Ajax.end(function(e){r(n.set(e.user))},i))})},t.prototype.update=function(t,n){var r=this;return t&&this.set(t),new i.Promise(function(t,i){var s=r._getObjForUserAPI();e.getAjax().put("users/"+r.userId,n).send(s).end(o.Ajax.end(function(e){t(r.set(e.user))},i))})},t.prototype.remove=function(e){return t.remove(this.userId,e)},t.remove=function(t,n){return new i.Promise(function(r,i){e.getAjax().remove("users/"+t,n).query({token:e.getAuthInfo().getToken()}).end(o.Ajax.end(r,i))})},t}()}var o=n(4),i=n(13);t.getUserClass=r,function(e){e[e.SuperAdmin=2]="SuperAdmin",e[e.Admin=3]="Admin",e[e.Manager=4]="Manager",e[e.User=5]="User"}(t.Role||(t.Role={}));var s=t.Role,u=function(){function e(t){return t instanceof e?t:t._groupId&&t._groupName&&t._roleName?(this._groupId=t._groupId,this._groupName=t._groupName,this._roleName=t._roleName,this):(t.group&&t.role&&(this._groupId=t.group.groupId,this._roleName=t.role.roleName,this._groupName=t.group.groupName),t.groupId&&(this._groupId=t.groupId),t.roleName&&!this._roleName&&(this._roleName=t.roleName),t.role&&!this._roleName&&(this._roleName=s[t.role],"SuperAdmin"==this._roleName&&(this._roleName="Super Admin")),t.groupName&&(this._groupName=t.groupName),void(t.description&&(this._description=t.description)))}return e.prototype.setGroupsRoles=function(e){return this._groupId=e.group.groupId,this._roleName=e.role.roleName,this},Object.defineProperty(e.prototype,"groupId",{get:function(){return this._groupId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupName",{get:function(){return this._groupName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"role",{get:function(){var e=this._roleName;return"Super Admin"==e&&(e="SuperAdmin"),s[e]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roleName",{get:function(){return this._roleName},enumerable:!0,configurable:!0}),e.prototype.getGroupsRolesForUserAPI=function(){return{group:{groupId:this.groupId},role:{roleName:this.roleName}}},e}();t.GroupsRoles=u},function(e,t,n){"use strict";function r(e){return function(){function t(e){this._columns={groupId:null,groupName:"",isAddCurrentApp:!1,description:""},this.set(e)}return Object.defineProperty(t.prototype,"groupId",{get:function(){return this._columns.groupId},set:function(e){this._columns.groupId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupName",{get:function(){return this._columns.groupName},set:function(e){this._columns.groupName=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this._columns.description},set:function(e){this._columns.description=e},enumerable:!0,configurable:!0}),t.prototype.set=function(e){var t=this;return Object.keys(this._columns).forEach(function(n){e[n]&&(t._columns[n]=e[n])}),this},t.list=function(n){return new i.Promise(function(r,i){e.getAjax().get("groups",n).query({token:e.getAuthInfo().getToken()}).end(o.Ajax.end(function(e){var n=e.groups.map(function(e){return new t(e)});r(n)},i))})},t.prototype.create=function(t,n){var r=this;return new i.Promise(function(t,i){e.getAjax().post("groups",n).send(r._columns).end(o.Ajax.end(function(e){t(r.set(e.group))},i))})},t.prototype.update=function(t,n){var r=this;return t&&this.set(t),new i.Promise(function(t,i){e.getAjax().update("groups/"+r.groupId,n).send(r._columns).end(o.Ajax.end(function(e){t(r.set(e.group))},i))})},t.prototype.remove=function(e){return t.remove(this.groupId,e)},t.remove=function(t,n){return new i.Promise(function(r,i){e.getAjax().remove("groups/"+t,n).query({token:e.getAuthInfo().getToken()}).end(o.Ajax.end(r,i))})},t}()}var o=n(4),i=n(13);t.getGroupClass=r},function(e,t,n){"use strict";function r(e){return function(){function t(e,t){this._name=e,this._url=t}return t.getUrl=function(t){return e.getConfig().entryPoint+"files/"+t+"?userToken="+e.getAuthInfo().getToken()},Object.defineProperty(t.prototype,"url",{get:function(){return e.getConfig().entryPoint+"files/"+this.name+"?userToken="+e.getAuthInfo().getToken()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t.create=function(n,r,s){var u=s?s:function(){},a=JSON.stringify({name:n});return new i.Promise(function(n,i){e.getAjax().post("files",{contentType:"no-set"}).field("entity",a).attach("file",r).on("progress",u).end(o.Ajax.end(function(e){var r=new t(e.results.name,e.results.url);n(r)},i))})},t.prototype.get=function(e){return t.get(this.name,e)},t.get=function(t,n){var r=n?n:function(){};return new i.Promise(function(n,i){e.getAjax().get("files/"+t).query("userToken="+e.getAuthInfo().getToken()).on("progress",r).end(o.Ajax.end(function(e){n(e)},i))})},t.prototype.update=function(n,r,s){var u=this,a=s?s:function(){},c=JSON.stringify({name:n});return new i.Promise(function(n,i){e.getAjax().put("files/"+u.name,{contentType:"no-set"}).field("entity",c).attach("file",r).on("progress",a).end(o.Ajax.end(function(e){var r=new t(e.results.name,e.results.url);n(r)},i))})},t.prototype.remove=function(t){var n=this;return new i.Promise(function(t,r){e.getAjax().remove("files/"+n.name).end(o.Ajax.end(function(e){t(e)},r))})},t}()}var o=n(4),i=n(13);t.getFileClass=r},function(e,t,n){"use strict";function r(e,t,n,r,o,u){var a="json",c=!1,p={};u&&(u.original&&(a="original",c=!0),u.headers&&(p=s(p,u.headers)));var f=r?r:{},l=o?o:void 0;l instanceof Array||void 0===l||(l=[l]);var h=n.replace(/^\//,"").replace(/\/$/,"");return new i.Promise(function(n,r){e("gateway/"+t+"/"+a+"/"+h).set(p).query(f).send(l).end(function(e,t){if(c)return n({error:e,response:t});if(e)return r({status:"error",results:e,response:t});var o=JSON.parse(t.text);return"OK"!=o.status?r({status:"error",results:e,response:t}):void n(o.results)})})}function o(e){return new u(e)}var i=n(13),s=n(3),u=function(){function e(e){this._ajax=e.getAjax()}return e.prototype.get=function(e,t,n,o,i){return r(this._ajax.get.bind(this._ajax),e,t,n,void 0,i)},e.prototype.post=function(e,t,n,o,i){return r(this._ajax.post.bind(this._ajax),e,t,n,o,i)},e.prototype.put=function(e,t,n,o,i){return r(this._ajax.put.bind(this._ajax),e,t,n,o,i)},e.prototype.remove=function(e,t,n,o,i){return r(this._ajax.remove.bind(this._ajax),e,t,n,void 0,i)},e}();t.getGateway=o}])});